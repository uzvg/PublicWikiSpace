created: 20250626135649046
description: ä½¿ç”¨git stashå‘½ä»¤ä¸äº¤äº’å¼rebaseä¿®æ”¹å†å²commit
modified: 20250626155507349
modifier: uzvg
progress: Completed
rating: Plain
source: å¦‚ä½•æŠŠæ–°æ·»åŠ çš„ä¿®æ”¹åˆå¹¶åˆ°å·²å­˜åœ¨çš„commitï¼Ÿ
tags: PermanentNotes Git
title: git stashä¸ä¿®æ”¹å†å²æäº¤
type: text/vnd.tiddlywiki
visibility: Public

!! å¼•è¨€ï¼š

è¯•æƒ³å¦‚ä¸‹åº”ç”¨åœºæ™¯ï¼š

æˆ‘ä»¬å‘ç°ä¸€ä¸ª''æ—§çš„æäº¤''ï¼ˆä¸æ˜¯æœ€æ–°çš„ï¼‰éœ€è¦è¡¥å……ä¿®æ”¹ï¼Œè€Œæˆ‘ä»¬å·²ç»æœ‰äº†æ–°çš„æäº¤åœ¨å…¶ä¹‹åï¼Œå…¶ä¸­ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨`git stash`+`git rebase`å‘½ä»¤ï¼Œå¤§è‡´è¿‡ç¨‹å¦‚ä¸‹ï¼š

```bash
git stash â¡ git rebase -i â¡ commit --amend â¡ git rebase --continue
```

è¯¥æ–¹æ³•å¯ä»¥ä¼˜é›…åœ°å°†è¡¥ä¸è¿½åŠ è¿›å†å²ä¸­çš„æŸä¸€æ¡æäº¤ï¼Œè€Œä¸ç ´åæäº¤é¡ºåºã€‚

!! æ“ä½œåŸç†ï¼š

# åœ¨å½“å‰åˆ†æ”¯ä¸Šå¯¹æ—§æäº¤è¿›è¡Œä¿®æ”¹ï¼›
# ä½¿ç”¨ `git stash` æš‚å­˜è¿™äº›ä¿®æ”¹ï¼›
# ä½¿ç”¨ `git rebase -i` å°†ç›®æ ‡ commit æ ‡è®°ä¸º `edit`/`e`ï¼›
# Git ä¼šåœ¨å˜åŸºè¿‡ç¨‹ä¸­åœåœ¨è¯¥ commitï¼›
# å–å‡º `stash` ä¸­çš„å˜æ›´ï¼Œå¹¶ä½¿ç”¨ `git commit --amend` ä¿®æ”¹æäº¤ï¼›
# ä½¿ç”¨ `git rebase --continue` ç»§ç»­ rebaseã€‚

!! âœ… æ“ä½œæ­¥éª¤è¯¦è§£

å‡è®¾ä½ è¦ä¿®æ”¹çš„ç›®æ ‡ commit æ˜¯ `C`ï¼Œå½“å‰å†å²å¦‚ä¸‹ï¼š

```
A -- B -- C -- D -- E (HEAD)
```

!!! 1. ä¿®æ”¹ä»£ç ï¼ˆä¿®å¤ C çš„é—®é¢˜ï¼‰

```bash
# åœ¨ E ä¸Šä¿®æ”¹ä»£ç ï¼Œä¿®å¤ C ä¸­çš„é—®é¢˜
# âš ï¸ è¯·ç¡®ä¿ä¿®æ”¹å†…å®¹åªé’ˆå¯¹ Cï¼Œä¸åŒ…å« D/E çš„é€»è¾‘
git stash push -m "fix for commit C"
```

!!! 2. å¼€å§‹äº¤äº’å¼ rebase

```bash
git rebase -i HEAD~4
```

åœ¨æ‰“å¼€çš„ç¼–è¾‘å™¨ä¸­æ‰¾åˆ°ç›®æ ‡ commit `C`ï¼Œå°†å‰é¢çš„ `pick` æ”¹æˆ `edit`ï¼š

```
pick 123abc B
edit 456def C
pick 789ghi D
pick 012jkl E
```

ä¿å­˜é€€å‡ºã€‚

!!! 3. Git åœåœ¨ C çš„æäº¤

```bash
HEAD is now at C
```

æ­¤æ—¶å·¥ä½œåŒºå¤„äº commit C çš„çŠ¶æ€ã€‚

!!! 4. æ¢å¤ä¹‹å‰ä¿®æ”¹

```bash
git stash pop
```

ç¡®è®¤ä¿®æ”¹å·²æ¢å¤ã€‚

!!! 5. ä¿®æ”¹è¯¥æäº¤

```bash
git add .
git commit --amend
```

ä½ ä¹Ÿå¯ä»¥é€‰æ‹©åªæ·»åŠ éƒ¨åˆ†å†…å®¹ï¼ˆå¦‚ä½¿ç”¨ `git add -p`ï¼‰ã€‚

!!! 6. ç»§ç»­ rebase

```bash
git rebase --continue
```

Git ä¼šç»§ç»­è‡ªåŠ¨åº”ç”¨ D å’Œ E çš„æäº¤ã€‚

!! âš ï¸ æ³¨æ„äº‹é¡¹

<<twks-alerter "warning" """
* âœ… æœ€ç»ˆè¢«æ·»åŠ åˆ°ç›®æ ‡ commit ä¸­çš„å†…å®¹ï¼Œå¿…é¡»åªä¸è¯¥ commit ç›¸å…³ï¼›
* ğŸ’¡ å³ä½¿ `stash` åŒ…å«å…¶ä»–å†…å®¹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ `git add -p` ç²¾ç¡®æŒ‘é€‰æƒ³è¦çš„éƒ¨åˆ†ï¼›
* âš ï¸ é¿å…ç›´æ¥ä½¿ç”¨ `git add .`ï¼Œä»¥å…è¯¯å°†å…¶ä»–ä¿®æ”¹ä¹Ÿ `amend` è¿›ç›®æ ‡ commitï¼›
* ğŸ¤ ä½¿ç”¨æ­¤æ–¹æ³•ä¼š''é‡å†™å†å²''ï¼Œä¿®æ”¹åéœ€ä½¿ç”¨ `git push --force-with-lease` æ¨é€ã€‚""">>